var defaultXinupMaping=new Array(0x1603,0x1503,0x1703,0x1403,0x1203,0x1303,0x1002,0x1302,0x1102,0x1202,0x1004,0x1402,0x1602,0x1702,0x1502,0x2012,0x2013,0x2006,0x2007,0x2008,0x2009);var XinputButtonMask=new Array(0x1000,0x2000,0x4000,0x8000,0x0100,0x0200,0x0010,0x0020,0x0040,0x0080,0x0400,0x0001,0x0002,0x0004,0x0008);$(document).ready(MJ_init);function MJ_init(){common();$('#DeviceType').change(function(){switch($(this).val()){case'1':$('.ObjectLayout').html($('#DS3Layout').html());break;case'2':$('.ObjectLayout').html($('#X360Layout').html());break;case'3':$('.ObjectLayout').html($('#XboxOLayout').html());break;default:$('.ObjectLayout').html($('#DS3Layout').html());break}for(var i=0;i<defaultXinupMaping.length;i++){$("#x360obj_"+i+' select').val('0x'+defaultXinupMaping[i].toString(16))}});$('#DeviceType').change();$('#XinputOptionDefault').click(function(){XinputmapDefault();mmm()});$.spin.imageBasePath='./xbox360_ct_files/';$('#Interval').spin({interval:10,min:20});$('#Duration').spin({interval:10,min:20});$('#DeviceType').change();XinputmapDefault();if(VersionTool>0){if(VersionTool>0x060000){$('#XinputOptionEnable').click(function(){var optionValue=0x0000;for(var i=0;i<defaultXinupMaping.length;i++){optionValue=parseInt($("#x360obj_"+i+' select').val());if(i>16){if($('#Reverse_'+i).is(':checked')){optionValue|=0x8000}}SetXinputOptionValue(i,0,optionValue)}var auto=0x0000;var turbo=0x0000;for(i=0;i<10;i++){if($('#XinputAuto_'+i).is(':checked'))auto|=$('#XinputAuto_'+i).val();if($('#XinputTrubo_'+i).is(':checked'))turbo|=$('#XinputTrubo_'+i).val()}SetXinputOptionValue(0,1,auto);SetXinputOptionValue(0,2,turbo);SetXinputOptionValue(0,3,$('#Interval').val());SetXinputOptionValue(0,4,$('#Duration').val());SetXinputOptionValue(0,5,$('#DeviceType').val());EnableConfig(0,0,5);mmm()});$('#XinputExport').click(function(){mmm();SetXinputOptionValue(0,7)});$('#XinputImport').click(function(){mmm();SetXinputOptionValue(0,6)});GetInfo()}else if((VersionTool>=0x060000)&&(VersionTool>=0x060000)){window.external.configDevice(1,0,4,0,0,0);$('#XinputOptionEnable').click(function(){var optionValue=0x0000;for(var i=0;i<defaultXinupMaping.length;i++){optionValue=parseInt($("#x360obj_"+i+' select').val());if(i>16){if($('#Reverse_'+i).is(':checked')){optionValue|=0x8000}}window.external.configDevice(0x0f,0,0,i,0,optionValue)}var auto=0x0000;var turbo=0x0000;for(i=0;i<10;i++){if($('#XinputAuto_'+i).is(':checked'))auto|=$('#XinputAuto_'+i).val();if($('#XinputTrubo_'+i).is(':checked'))turbo|=$('#XinputTrubo_'+i).val();window.external.configDevice(0x0f,0,3,i,parseInt($("#XinputMacro_"+i).val()),0)}window.external.configDevice(0x0f,0,1,0,0,auto);window.external.configDevice(0x0f,0,2,0,0,turbo);window.external.configDevice(0x0f,0,3,0,0,$('#Interval').val());window.external.configDevice(0x0f,0,4,0,0,$('#Duration').val());window.external.configDevice(0x0f,0,5,0,0,$('#DeviceType').val());window.external.configDevice(2,0xff,5,0,0,0)});$('#XinputExport').click(function(){window.external.configDevice(0x11,0,1,1,0,0)});$('#XinputImport').click(function(){window.external.configDevice(0x11,0,0,1,0,0);window.external.configDevice(1,0,4,0,0,0)})}else{$('#XinputOptionEnable').click(function(){alert("need ds3_tool version 0.6+,Driver version 0.6+")})}}}function GetInfo(){var auto=parseInt(GetXinputOptionValue(0,1));var turbo=parseInt(GetXinputOptionValue(0,2));for(var i=0;i<10;i++){if((auto&XinputButtonMask[i])!=0){$('#XinputAuto_'+i).attr('checked',true)}else{$('#XinputAuto_'+i).attr('checked',false)}if((turbo&XinputButtonMask[i])!=0){$('#XinputTrubo_'+i).attr('checked',true)}else{$('#XinputTrubo_'+i).attr('checked',false)}}$('#Interval').val(parseInt(GetXinputOptionValue(0,3)));$('#Duration').val(parseInt(GetXinputOptionValue(0,4)));$('#DeviceType').val(parseInt(GetXinputOptionValue(0,5)));$('#DeviceType').change();for(var i=0;i<defaultXinupMaping.length;i++){var mapValue=parseInt(GetXinputOptionValue(i,0));$("#x360obj_"+i+' select').val('0x'+(mapValue&0x7fff).toString(16));if(i>16){if((mapValue&0x8000)!=0){$('#Reverse_'+i).attr('checked',true)}else{$('#Reverse_'+i).attr('checked',false)}}}}function XinputmapDefault(){for(var i=0;i<defaultXinupMaping.length;i++){$("#x360obj_"+i+' select').val('0x'+defaultXinupMaping[i].toString(16))}$("input[type='checkbox']").attr('checked',false);$("#Reverse_18").attr('checked',true);$("#Reverse_20").attr('checked',true)}function setConfig(){if(arguments.length>1){switch(arguments[0]){case 4:for(var i=0;i<10;i++){if((arguments[1]&XinputButtonMask[i])!=0){$('#XinputAuto_'+i).attr('checked',true)}else{$('#XinputAuto_'+i).attr('checked',false)}if((arguments[2]&XinputButtonMask[i])!=0){$('#XinputTrubo_'+i).attr('checked',true)}else{$('#XinputTrubo_'+i).attr('checked',false)}}$('#Interval').val(arguments[3]);$('#Duration').val(arguments[4]);$('#DeviceType').val(arguments[5]);$('#DeviceType').change();for(var i=0;i<defaultXinupMaping.length;i++){$("#x360obj_"+i+' select').val('0x'+(arguments[i+10]&0x7fff).toString(16));if(i>16){if((arguments[i+10]&0x8000)!=0){$('#Reverse_'+i).attr('checked',true)}else{$('#Reverse_'+i).attr('checked',false)}}}break}}}(function($){var calcFloat={get:function(num){var num=num.toString();if(num.indexOf('.')==-1)return[0,eval(num)];var nn=num.split('.');var po=nn[1].length;var st=nn.join('');var sign='';if(st.charAt(0)=='-'){st=st.substr(1);sign='-'}for(var i=0;i<st.length;++i)if(st.charAt(0)=='0')st=st.substr(1,st.length);st=sign+st;return[po,eval(st)]},getInt:function(num,figure){var d=Math.pow(10,figure);var n=this.get(num);var v1=eval('num * d');var v2=eval('n[1] * d');if(this.get(v1)[1]==v2)return v1;return(n[0]==0?v1:eval(v2+'/Math.pow(10, n[0])'))},sum:function(v1,v2){var n1=this.get(v1);var n2=this.get(v2);var figure=(n1[0]>n2[0]?n1[0]:n2[0]);v1=this.getInt(v1,figure);v2=this.getInt(v2,figure);return eval('v1 + v2')/Math.pow(10,figure)}};$.extend({spin:{imageBasePath:'./xbox360_ct_files/',spinBtnImage:'spin-button.png',spinUpImage:'spin-up.png',spinDownImage:'spin-down.png',interval:1,max:null,min:null,timeInterval:500,timeBlink:200,btnClass:null,btnCss:{cursor:'pointer',padding:0,margin:0,verticalAlign:'middle'},txtCss:{marginRight:0,paddingRight:0},lock:false,decimal:null,beforeChange:null,changed:null,buttonUp:null,buttonDown:null}});$.fn.extend({spin:function(o){return this.each(function(){o=o||{};var opt={};$.each($.spin,function(k,v){opt[k]=(typeof o[k]!='undefined'?o[k]:v)});var txt=$(this);var spinBtnImage=opt.imageBasePath+opt.spinBtnImage;var btnSpin=new Image();btnSpin.src=spinBtnImage;var spinUpImage=opt.imageBasePath+opt.spinUpImage;var btnSpinUp=new Image();btnSpinUp.src=spinUpImage;var spinDownImage=opt.imageBasePath+opt.spinDownImage;var btnSpinDown=new Image();btnSpinDown.src=spinDownImage;var btn=$(document.createElement('img'));btn.attr('src',spinBtnImage);if(opt.btnClass)btn.addClass(opt.btnClass);if(opt.btnCss)btn.css(opt.btnCss);if(opt.txtCss)txt.css(opt.txtCss);txt.after(btn);if(opt.lock){txt.focus(function(){txt.blur()})}function spin(vector){var val=txt.val();var org_val=val;if(opt.decimal)val=val.replace(opt.decimal,'.');if(!isNaN(val)){val=calcFloat.sum(val,vector*opt.interval);if(opt.min!==null&&val<opt.min)val=opt.min;if(opt.max!==null&&val>opt.max)val=opt.max;if(val!=txt.val()){if(opt.decimal)val=val.toString().replace('.',opt.decimal);var ret=($.isFunction(opt.beforeChange)?opt.beforeChange.apply(txt,[val,org_val]):true);if(ret!==false){txt.val(val);if($.isFunction(opt.changed))opt.changed.apply(txt,[val]);txt.change();src=(vector>0?spinUpImage:spinDownImage);btn.attr('src',src);if(opt.timeBlink<opt.timeInterval)setTimeout(function(){btn.attr('src',spinBtnImage)},opt.timeBlink)}}}if(vector>0){if($.isFunction(opt.buttonUp))opt.buttonUp.apply(txt,[val])}else{if($.isFunction(opt.buttonDown))opt.buttonDown.apply(txt,[val])}}btn.mousedown(function(e){var pos=e.pageY-btn.offset().top;var vector=(btn.height()/2>pos?1:-1);(function(){spin(vector);var tk=setTimeout(arguments.callee,opt.timeInterval);$(document).one('mouseup',function(){clearTimeout(tk);btn.attr('src',spinBtnImage)})})();return false})})}})})(jQuery);