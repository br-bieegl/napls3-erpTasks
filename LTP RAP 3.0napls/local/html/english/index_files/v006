$(document).ready(MJ_init);function MJ_init(){common();$("#BatteryBar").progressbar({value:0});$("#tabs").tabs({event:'mouseover'});$("#vibration_strength_left").slider({animate:true,range:"min",min:0,max:150,value:100,change:function(event,ui){$("#leftMotor").html($("#vibration_strength_left").slider('option','value')+'%')}});$("#vibration_strength_right").slider({animate:true,range:"min",min:0,max:150,value:100,change:function(event,ui){$("#rightMotor").html($("#vibration_strength_right").slider('option','value')+'%')}});$('#CustomPList').click(function(){$(":input[@type=radio]").filter('[value=0]').attr('checked',true)});if(VersionTool>0){VersionDriver=window.external.getVersion(1);if(VersionTool>0x060000){$("#vibrationTest").click(function(){SetVibrationLevel($("#vibration_strength_left").slider('option','value'),$("#vibration_strength_right").slider('option','value'));Vibration($("#ControllerList :selected").val(),$("#ControllerList :selected").attr("title"),255,255);mmm()});$("#mod_enable").click(function(){var led=0x00;switch($(":radio[name='LED'][checked]").val()){case'0':break;case'1':led=0x80;if($("#LED1").attr("checked"))led|=0x01;if($("#LED2").attr("checked"))led|=0x02;if($("#LED3").attr("checked"))led|=0x04;if($("#LED4").attr("checked"))led|=0x08;break;default:break}SetLED(led);if($(":radio[name='mode'][checked]").val()==0){ChangeProfile($("#CustomPList").find("option:selected").text())}SetVibrationLevel($("#vibration_strength_left").slider('option','value'),$("#vibration_strength_right").slider('option','value'));EnableConfig($("#ControllerList :selected").val(),$("#ControllerList :selected").attr("title"),$(":radio[name='mode'][checked]").val());mmm()});$('#Disconnect').click(function(){DisconnectController($("#ControllerList :selected").val(),$("#ControllerList :selected").attr("title"))});$("#CustomPList").change(function(){ChangeProfile($("#CustomPList").find("option:selected").text())});GetInfo();timer6()}else if(VersionTool>=0x050000){$('#ControllerList').change(function(){window.external.configDevice(3,$("#ControllerList :selected").val(),0,0,0,0)});$("#mod_enable").click(function(){setModeOption($("#ControllerList :selected").val(),$(":radio[name='mode'][checked]").val(),$("#vibration_strength_left").slider('option','value'),$("#vibration_strength_right").slider('option','value'));Mconfig()});$("#vibrationTest").click(function(){window.external.configDevice(4,$("#ControllerList :selected").val(),$("#vibration_strength_left").slider('option','value'),$("#vibration_strength_right").slider('option','value'),1,0);Mconfig()});$('#Disconnect').click(function(){window.external.configDevice(13,$("#ControllerList :selected").val(),0,0,0,0);Mconfig()});if(VersionTool>=0x060000){$("#CustomPList").change(function(){window.external.configDevice2(4,0,5,0,0,$("#CustomPList").find("option:selected").text())})}window.external.configDevice2(4,0,0,0,0,'');if(VersionTool<0x060000){if(window.external.configDevice(8,0,1,0,0,0)!=0){NeedUpdate()}}timer();window.external.configDevice(1,0,0,0,0,0)}else{window.$MijVib=0;window.external.configDevice(5,0,0,0,0,0);$("#mod_enable").click(function(){setModeOption($("#ControllerList :selected").val(),$(":radio[name='mode'][checked]").val(),$("#vibration_strength_left").slider('option','value'),$("#vibration_strength_right").slider('option','value'));Mconfig()});$("#vibrationTest").click(function(){window.$MijVib=window.$MijVib?0:1;window.external.configDevice(4,$("#ControllerList :selected").val()-1,window.$MijVib,0,0,0);Mconfig()});$('#GamepadProperty').click(function(){alert('Need DS3 tool ver 0.5+')});$('#Disconnect').click(function(){alert('Need DS3 tool ver 0.5+')});timerv4();window.external.configDevice(1,0,0,0,0,0)}}else{$("#ProfileSave").click(function(){$("#SaveDialog").dialog('open')});$("#ProfileOpen").click(function(){$("#OpenDialog").dialog('open')})}}function GetInfo(){var ControllerList=0;var DeviceName="";$('#ControllerList').html('<option value="0">'+$('#NoController').html()+'</option>');var DeviceCount=GetDeviceCount();for(var i=0;i<DeviceCount;i++){var ControllerCount=GetLocalBTinfo(i,0);for(var j=0;j<ControllerCount;j++){if(GetControllerinfo(i,j,1)=="True"){var controllerType=GetControllerinfo(i,j,0);switch(controllerType){case"0":DeviceName=$('#USBDS3').html();break;case"1":DeviceName=$('#XBOX360WIRED').html();break;case"2":DeviceName=$('#XBOX360WIRELESS').html();break;case"3":DeviceName=$('#XBOXCONTROLLER').html();break;case"4":DeviceName=$('#USBPS3KEYPAD').html();break;case"5":DeviceName=$('#USBPSMOVE').html();break;case"6":DeviceName=$('#USBPSNAVIGATION').html();break;case"129":DeviceName=$('#BTDS3').html();break;case"130":DeviceName=$('#PS3KEYPAD').html();break;case"131":DeviceName=$('#PS3REMOTE').html();break;case"132":DeviceName=$('#WIIMOTE').html();break;case"133":DeviceName=$('#PSMOVE').html();break;case"134":DeviceName=$('#BTPSNAVIGATION').html();break;default:DeviceName="Uknow Type";break}if(ControllerList==0){$('#ControllerList').html('')}ControllerList++;$('<option value="'+i+'" title="'+j+'">'+ControllerList+'.'+DeviceName+'</option>').appendTo('#ControllerList')}}}GetprofileList();$(".ModeLists :input[@type=radio]").filter('[value='+GetProfileMOde()+']').attr('checked',true);$("#vibration_strength_left").slider('option','value',GetVibrationLevel(1));$("#vibration_strength_right").slider('option','value',GetVibrationLevel(2));$('#CustomPList option:[text='+GetCurrenProfile()+']').attr('selected','true');var led=GetLED();if((led&0x80)==0x00){$('#LEDMODE1').attr('checked',true)}else{$('#LEDMODE2').attr('checked',true);if((led&0x01)!=0)$('#LED1').attr('checked',true);if((led&0x02)!=0)$('#LED2').attr('checked',true);if((led&0x04)!=0)$('#LED3').attr('checked',true);if((led&0x08)!=0)$('#LED4').attr('checked',true)}}function EventHander(){switch(arguments[0]){case 1:GetInfo();break;default:break}}function displayPower(power){switch(power){case 0xee:var value=$("#BatteryBar").progressbar('option','value')+20;if(value>100){value=20}$("#BatteryBar").progressbar('option','value',value);break;case 5:case 0xef:$("#BatteryBar").progressbar('option','value',100);$("#batteryLev").html(value+'%');$("#batteryLev").html(100+'%');break;case 4:$("#BatteryBar").progressbar('option','value',80);$("#batteryLev").html(80+'%');break;case 3:$("#BatteryBar").progressbar('option','value',60);$("#batteryLev").html(60+'%');break;case 2:$("#BatteryBar").progressbar('option','value',40);$("#batteryLev").html(40+'%');break;case 1:$("#BatteryBar").progressbar('option','value',10);$("#batteryLev").html(10+'%');break;default:break}}function timer6(){displayPower(parseInt(GetControllerinfo($("#ControllerList :selected").val(),$("#ControllerList :selected").attr("title"),4)));setTimeout('timer6()',1000)}function setModeOption(index,mode,lVibration,rVibration){if((VersionTool>=0x050000)){if(mode==0){window.external.configDevice2(4,index,5,0,0,$("#CustomPList").find("option:selected").text())};window.external.configDevice(2,index,mode,lVibration,rVibration,1)}else{if(mode==0){window.external.SelectProfile($("#CustomPList").find("option:selected").text())}window.external.configDevice(2,index-1,mode,lVibration,rVibration,1)}}function timer(){displayPower(window.external.configDevice(11,$("#ControllerList :selected").val(),0,0,0,0));setTimeout('timer()',1000)}function timerv4(){displayPower(window.$MijBattery);var index=$("#ControllerList :selected").val();if(index>0){window.external.configDevice(3,index-1,0,0,0,0);if(window.$MijVib)window.external.configDevice(4,index-1,1,0,0,0)}setTimeout('timerv4()',1000)}function setConfig(){if(VersionTool>=0x050000){if(arguments.length>1){switch(arguments[0]){case 0:if(arguments[1]>0){var DeviceName=$('#ControllerName').html();$('#ControllerList').html('');for(var i=0;i<arguments[1];i++){$('<option value="'+i+'">'+(i+1)+'.'+DeviceName+'</option>').appendTo('#ControllerList')}}else{$('#ControllerList').html('<option value="0">'+$('#NoController').html()+'</option>')}case 3:$("#vibration_strength_left").slider('option','value',arguments[2]);$("#vibration_strength_right").slider('option','value',arguments[3]);$(".ModeLists :input[@type=radio]").filter('[value='+arguments[1]+']').attr('checked',true);break;default:break}}}else{if(arguments.length>1){switch(arguments[0]){case 0:if(arguments[1]>0){$('#ControllerList').html('')}break;case 1:if(arguments.length>7){var DeviceName=$('#ControllerName').html();var index=arguments[1]+1;$('<option value="'+index+'">'+index+'.'+DeviceName+'</option>').appendTo('#ControllerList');$("#vibration_strength_left").slider('option','value',arguments[3]);$("#vibration_strength_right").slider('option','value',arguments[4]);window.$MijBattery=arguments[7]}break;case 3:window.$MijBattery=arguments[7];break;default:break}}}}function ProfileList(){if(arguments.length>2){var i=0;if(arguments[1]>0){$(".ProfileList").html("");if(VersionTool<0x060000){for(i=0;i<arguments[1];i++){$('<option value="'+i+'">'+arguments[i+2]+'</option>').appendTo('.ProfileList')}}else{for(i=0;i<arguments[1];i++){$('<option value="'+i+'">'+arguments[i+10]+'</option>').appendTo('.ProfileList')}if(arguments[2]<=arguments[1]){$("#CustomPList").val(arguments[2])}}}}}